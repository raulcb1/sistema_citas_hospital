Código a continuacion
<?php
include 'config.php';

if ($_SESSION['rol'] != 'admin') {
    header("Location: sin_permisos.php");
    exit();
}

$servicios = $conn->query("SELECT id, nombre FROM servicios WHERE activo = 1");

?>
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <h1>Programación de Consultorios</h1>
        </div>
    </div>
</section>
<section class="content">
    <div class="container-fluid">



        <!-- Botón para abrir el modal de programación recurrente -->
        <button class="btn btn-success" data-toggle="modal" data-target="#modalProgramacionRecurrente">
            <i class="fas fa-calendar-alt"></i> Programación Recurrente
        </button>

        <!-- Modal para programación recurrente -->
        <div class="modal fade" id="modalProgramacionRecurrente">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-primary">
                        <h5 class="modal-title">Programación Recurrente</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <form id="formProgramacionRecurrente" method="POST">
                        <div class="modal-body">
                            <div class="row">
                                <!-- Selección de médico, consultorio y turno -->
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Médico:</label>
                                        <select name="medico_id" class="form-control" required>
                                            <?php
                                    $medicos = $conn->query("SELECT m.id, u.nombre 
                                                             FROM medicos m 
                                                             INNER JOIN usuarios u ON m.usuario_id = u.id");
                                    while ($medico = $medicos->fetch_assoc()): ?>
                                            <option value="<?php echo $medico['id']; ?>">
                                                <?php echo $medico['nombre']; ?>
                                            </option>
                                            <?php endwhile; ?>
                                        </select>
                                    </div>
                                </div>
                                <!-- <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Consultorio:</label>
                                        <select name="consultorio_id" class="form-control" required>
                                            <?php
                                    $consultorios = $conn->query("SELECT * FROM consultorios");
                                    while ($consultorio = $consultorios->fetch_assoc()): ?>
                                            <option value="<?php echo $consultorio['id']; ?>">
                                                <?php echo $consultorio['nombre']; ?>
                                            </option>
                                            <?php endwhile; ?>
                                        </select>
                                    </div>
                                </div> -->
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Servicios:</label>
                                        <select name="servicio_id" class="form-control" required>
                                            <?php while ($servicio = $servicios->fetch_assoc()): ?>
                                            <option value="<?php echo $servicio['id']; ?>">
                                                <?php echo $servicio['nombre']; ?>
                                            </option>
                                            <?php endwhile; ?>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Turno:</label>
                                        <select name="turno" class="form-control" required>
                                            <option value="mañana">Mañana</option>
                                            <option value="tarde">Tarde</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Opciones de repetición -->
                            <div class="form-group">
                                <label>Frecuencia:</label>
                                <select id="frecuencia" class="form-control">
                                    <option value="unica">Única</option>
                                    <option value="diaria">Diaria</option>
                                    <option value="semanal">Semanal (días específicos)</option>
                                    <!-- <option value="mensual">Mensual (mismo día cada mes)</option> -->
                                </select>
                            </div>

                            <!-- Selector de rango de fechas -->
                            <!-- <div class="form-group">
                                <label>Rango de Fechas:</label>
                                <div class="input-daterange input-group" id="rangoFechas">
                                    <input type="date" class="form-control" name="fecha_inicio" required>
                                    <div class="input-group-append">
                                        <span class="input-group-text">al</span>
                                    </div>
                                    <input type="date" class="form-control" name="fecha_fin" required>
                                </div>
                            </div> -->




                            <div class="form-group" id="fechaUnica">
                                <label>Fecha:</label>
                                <input type="date" class="form-control" name="fecha_inicio" value="<?php echo date('Y-m-d'); ?>" required>
                            </div>
                            <div class="form-group" id="rangoFechas" style="display: none;">
                                <label>Rango de Fechas:</label>
                                <div class="input-daterange input-group">
                                    <input type="date" class="form-control" name="fecha_inicio" value="<?php echo date('Y-m-d'); ?>" required>
                                    <div class="input-group-append">
                                        <span class="input-group-text">al</span>
                                    </div>
                                    <input type="date" class="form-control" name="fecha_fin" value="<?php echo date('Y-m-d'); ?>" required>
                                </div>
                            </div>




                            <!-- Días de la semana (solo para frecuencia semanal) -->
                            <div class="form-group" id="diasSemana" style="display: none;">
                                <label>Días:</label>
                                <div class="row">
                                    <?php 
                                    $dias = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];
                                    foreach ($dias as $dia): ?>
                                    <div class="col-md-3">
                                        <div class="icheck-primary">
                                            <input type="checkbox" id="dia_<?php echo strtolower($dia); ?>"
                                                name="dias[]" value="<?php echo $dia; ?>">
                                            <label for="dia_<?php echo strtolower($dia); ?>"><?php echo $dia; ?></label>
                                        </div>
                                    </div>
                                    <?php endforeach; ?>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" name="guardar_recurrente" class="btn btn-primary">
                                <i class="fas fa-save"></i> Guardar Programación
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- Incluir SweetAlert2 -->
<script>
$(document).ready(function() {
    // Establecer el idioma en español para moment.js
    moment.locale('es');

    // Mostrar/ocultar campos según la frecuencia
    $('#frecuencia').change(function() {
        const frecuencia = $(this).val();
        if (frecuencia === 'unica') {
            $('#rangoFechas').hide(); // Ocultar rango de fechas
            $('#diasSemana').hide(); // Ocultar días de la semana
            $('#fechaUnica').show(); // Mostrar solo fecha_inicio

            // Ajustar atributos 'required'
            $('input[name="fecha_inicio"]').prop('required', true);
            $('input[name="fecha_fin"]').prop('required', false);
            $('input[name="dias[]"]').prop('required', false);
        } else if (frecuencia === 'semanal') {
            $('#fechaUnica').hide(); // Ocultar fecha única
            $('#rangoFechas').show(); // Mostrar rango de fechas
            $('#diasSemana').show(); // Mostrar días de la semana

            // Ajustar atributos 'required'
            $('input[name="fecha_inicio"]').prop('required', true);
            $('input[name="fecha_fin"]').prop('required', true);
            $('input[name="dias[]"]').prop('required', true);
        } else if (frecuencia === 'diaria') {
            $('#fechaUnica').hide(); // Ocultar fecha única
            $('#rangoFechas').show(); // Mostrar rango de fechas
            $('#diasSemana').hide(); // Ocultar días de la semana

            // Ajustar atributos 'required'
            $('input[name="fecha_inicio"]').prop('required', true);
            $('input[name="fecha_fin"]').prop('required', true);
            $('input[name="dias[]"]').prop('required', false);
        }
    });

    // Inicializar el modal con frecuencia "Única"
    $('#modalProgramacionRecurrente').on('show.bs.modal', function() {
        $('#frecuencia').val('unica').trigger('change');
    });

    // Enviar datos al servidor
    $('#formProgramacionRecurrente').submit(function(e) {
        e.preventDefault();
        const formData = $(this).serializeArray();

        // Log para depuración
        console.log('Datos del formulario:', formData);

        // Calcular fechas según la frecuencia
        const fechaInicio = moment(formData.find(f => f.name === 'fecha_inicio').value);
        const fechaFin = moment(formData.find(f => f.name === 'fecha_fin').value);
        const frecuencia = formData.find(f => f.name === 'frecuencia').value;
        const dias = formData.filter(f => f.name === 'dias[]').map(d => d.value);

        let fechas = [];
        let currentDate = fechaInicio.clone();

        while (currentDate <= fechaFin) {
            switch (frecuencia) {
                case 'diaria':
                    fechas.push(currentDate.format('YYYY-MM-DD'));
                    break;
                case 'semanal':
                    if (dias.includes(currentDate.format('dddd'))) {
                        fechas.push(currentDate.format('YYYY-MM-DD'));
                    }
                    break;
                case 'mensual':
                    fechas.push(currentDate.format('YYYY-MM-DD'));
                    currentDate.add(1, 'month');
                    continue; // Saltar el día siguiente
                default: // Única
                    fechas.push(fechaInicio.format('YYYY-MM-DD'));
                    break;
            }
            currentDate.add(1, 'day');
        }

        // Enviar fechas al servidor
        $.ajax({
            url: 'funciones/guardar_asignaciones_recurrentes.php',
            method: 'POST',
            data: {
                medico_id: formData.find(f => f.name === 'medico_id').value,
                consultorio_id: formData.find(f => f.name === 'servicio_id').value,
                turno: formData.find(f => f.name === 'turno').value,
                fechas: fechas
            },
            success: function(response) {
                if (response.success) {
                    Swal.fire('¡Éxito!', 'Asignaciones guardadas correctamente.',
                    'success');
                    $('#modalProgramacionRecurrente').modal('hide');
                    calendar.refetchEvents(); // Recargar el calendario
                } else {
                    Swal.fire('Error', response.error, 'error');
                }
            }
        });
    });
});
</script>